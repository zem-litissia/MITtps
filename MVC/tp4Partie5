from tkinter import Tk, Label, Button, Text, END, W, E
from model_file import model_file


class view_tk:
    """Vue graphique Tkinter reliée au modèle fichier"""

    def __init__(self, model):
        self.model = model

        master = Tk()
        self.master = master
        master.title("Directory - MVC GUI")

        # Champs de saisie
        self.label_family = Label(master, text="Family Name:")
        self.label_firstname = Label(master, text="First Name:")
        self.label_tel = Label(master, text="Tel:")

        self.entry_family = Text(master, height=1, width=30)
        self.entry_firstname = Text(master, height=1, width=30)
        self.entry_tel = Text(master, height=1, width=30)

        # Boutons
        self.search_button = Button(master, text="Search", command=lambda: self.update("search"))
        self.add_button = Button(master, text="Add", command=lambda: self.update("add"))
        self.all_button = Button(master, text="Get All", command=lambda: self.update("get_all"))

        # Zone de sortie
        self.output_label = Label(master, text="Output:")
        self.output = Text(master, height=10, width=80)

        # Disposition (Layout)
        self.label_family.grid(row=0, column=0, sticky=W)
        self.label_firstname.grid(row=0, column=1, sticky=W)
        self.label_tel.grid(row=0, column=2, sticky=W)

        self.entry_family.grid(row=1, column=0, sticky=W+E)
        self.entry_firstname.grid(row=1, column=1, sticky=W+E)
        self.entry_tel.grid(row=1, column=2, sticky=W+E)

        self.search_button.grid(row=2, column=0, pady=5)
        self.add_button.grid(row=2, column=1, pady=5)
        self.all_button.grid(row=2, column=2, pady=5)

        self.output_label.grid(row=3, column=0, sticky=W)
        self.output.grid(row=4, column=0, columnspan=3, sticky=W+E)

    # Méthode appelée par les boutons
    def update(self, method):
        familyname = self.entry_family.get("1.0", END).strip()
        firstname = self.entry_firstname.get("1.0", END).strip()
        tel = self.entry_tel.get("1.0", END).strip()

        # Efface la sortie avant d’afficher le nouveau résultat
        self.output.delete("1.0", END)

        if method == "search":
            result = self.search(familyname)
        elif method == "add":
            result = self.add(familyname, firstname, tel)
        elif method == "get_all":
            result = self.get_all()
        else:
            result = "Unknown method"

        self.output.insert(END, str(result) + "\n")

    # Fonctions reliées au modèle
    def add(self, familyname, firstname, tel):
        self.model.add(familyname, firstname, tel)
        return f"Added: {familyname} {firstname} ({tel})"

    def search(self, familyname):
        result = self.model.search(familyname)
        if result:
            return result
        else:
            return f"'{familyname}' not found"

    def get_all(self):
        return self.model.get_all()

    def run(self):
        self.master.mainloop()


# Contrôleur principal
def controller3():
    """Controller for graphical MVC"""
    data_model = model_file()
    my_viewer = view_tk(data_model)
    my_viewer.run()


if __name__ == "__main__":
    controller3()
